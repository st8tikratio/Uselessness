# Some notes on Dandelion Lite (Pre-Prod & Mainnet) Node
ðŸ›‘ Dates are sorted most recent to oldest ðŸ›‘
---

###### 15 APRIL 2025
```
!!!!!!!!!! STILL TESTING AND CREATING NOTES FOR THIS DAY !!!!!!!!!
```
### CHANGE WAL VALUE IN POSTGRES
While running the following command:
```
docker logs -f dandolite-mainnet-postgress-1 
```
A message was frequently displayed:
```
HINT: Consider increasing the configuration parameter "max_wal_size"
```
Leading to inquiring how to change the `max_wal_size` as described below:
Change directory to correct container
```
cd into container directory

example: cd services/dandelion-lite
```
check **postgres** version
```
docker compose exec -it postgress psql -U dandelion_user -d dandelion_lite
```
paste the following
```
ALTER SYSTEM SET max_wal_size = '2GB';
SELECT pg_reload_conf();

press ENTER
```
to exit
```
\q
```

### CHECK POSTGRES VERSION
change directory to correct container
```
cd into container directory

example: cd services/dandelion-lite
```
check **postgres** version
```
docker compose exec -it postgress psql -U dandelion_user -d dandelion_lite
SELECT version();
```
ouput
```
Your output should be similar to:

PostgreSQL 16.1 (Debian 16.1-1.pgdg110+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 10.2.1-6) 10.2.1 20210110, 64-bit
```
exit
```
\q
```

### OBSERVED POWER USAGE
```
Measured from a Cyberpower 1500W Battery Backup
```
| **TYPE**   | **UNIT**    | **MEASUREMENT 1** | **MEASUREMENT 2** |
| ---------         | ---------   | ---------------    |  -------------    |
| **FIXED OBSERVATION**  | | | |
| `input voltage`   | volts (V)   | 122                |     --            |
| `output voltage`   | volts (V)   | 122                |     --           |
| `output frequency` | hertz (Hz)  | 60                 |   --             |
| **RANGED OBSERVATIONS** | | | |
| power usage        | watts (W)    | 210  | 283  |
| power draw         | volts (V)    | 204  | 218  |


### ROGUE PROCESS (postgresdb)
- now sitting at 1.33TB on `home`, then right back to 1.31TB within seconds
- it is `dandolite-mainnet_postgresdb` causing the exceptional disk usage

#### REMOVING EXISTING CONTAINER AND RE-IMPLEMENTING
remove postgresdb container
```
cd [your path to dandelion-lite mainnet]

eample:
cd services/dandelion-lite
```
```
docker compose down
```
```
./scripts/docker/list-volume-sizes.sh
```
```
docker volume rm /dandolite-mainnet_postgresdb
```
```
docker compose up
```
check that container is gone
```
./scripts/docker/list-volume-sizes.sh
```
re-initialize postgres
```
scripts/dandoman.sh
```
```
select Docker
```
```
select Docker Status
```
make sure all things show up
- if not, wait or check back later

```
select BACK
```
```
select SETUP
```
```
select INTIALIZE POSTGRES
```

### Docker Volume Sizes
- checked `docker volume sizes` using
```
./scripts/docker/list-volume-sizes.sh
```
- output
<img width="899" alt="image" src="https://github.com/user-attachments/assets/be9dbcaa-630a-4305-9228-3345ea978627" />

### ~~Docker's False Positive~~
#### **LATER TOLD THE OUTPUT FROM THE BELOW IS NOT ACCURATE**
```
- navigated to both:
  cd services/dandelione-lite
  cd services/dandelion-lite-preprod
and executed
  scripts/dandoman.sh
```

### Glances (Sys Overview)
- `home` dropped to `1.30T` then quickly jumped to `1.31T`
- `glances` output below
<img width="1800" alt="image" src="https://github.com/user-attachments/assets/735486a8-f158-4e71-b1fa-683b7f0b63fc" />

---


###### 13 APRIL 2025
## Pre-shutdown
- Primary drive sitting at `1.33 TB`
- CPU usage `very high`
- Uptime is `< 36 hours`
- There are four instances of:
  ```
  /bin/sh -c echo ...
  
  These are associated with ogmios and port 1337 and vary in CPU usage over time.
  ```
  
  ![galnces-preShutdown-13-apr-2025](https://github.com/user-attachments/assets/051e44fc-2eb3-44f1-888e-1c96b5b7c41d)

## Post-shutdown
- Primary drive now at `1.30 TB`
- Brave usage is `weird and high`, it appears
- Guess is `THE PROCESSES BELOW` are associated with the Desktop version of Ubuntu and not present in Server
- Researching ways to kill or remove the following processes

  ```
  Evolution Services - https://askubuntu.com/questions/1350406/proper-way-to-disable-evolution-services-when-its-purged-already
  Tracker-Miner-F3 - https://unix.stackexchange.com/questions/704220/what-is-tracker-miner-f-and-how-to-stop-it
  Pipewire Pulse and wireplumber
  ```
  ![galnces-postShutdown-13-apr-2025](https://github.com/user-attachments/assets/e2fd133a-5d6c-405b-b8c2-bc95f0b5431b)

##### 11 APR 2025

```
Recognized four instances of `patches` running in Glances
All instances are related to OGMIOS
```

<img width="1765" alt="image" src="https://github.com/user-attachments/assets/0bd24271-c4f7-48f9-b030-13448a217753" />

```
The below image was found in the mainnet DOCKER logs

NOTES:
You will need to zoom-in in order to see the entry
```
<img width="1796" alt="image" src="https://github.com/user-attachments/assets/b4bddb05-84fb-4ed8-9ae3-c94f4a3df99e" />

#### Shortly after the above; the log terminated with the following:
```
Error response from daemon: no container with ID f6ad5f554dc95fe7c5c18d0d28049089bf23078f0a5d56dd87d848163499bb02 found in database: no such container
Error: executing /usr/local/bin/docker-compose-v2 logs -f: exit status 1
```
