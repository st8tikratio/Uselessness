# Some notes on Dandelion Lite (Pre-Prod & Mainnet) Node
### ðŸ›‘ Dates are sorted most recent to oldest ðŸ›‘
---
###### 16 APRIL 2025
### OTHER TOOLS
#### IOTOP

<img width="1798" alt="image" src="https://github.com/user-attachments/assets/d1601ced-2bf4-4cb8-b0d6-77eb5df1fba9" />

```
This tool is similar to Glances
```
Install with:
```
sudo apt install iotop
```
Open tool:
```
sudo iotop
ENTER
```
See help:
```
sudo iotop -h
```
Kill tool:
```
CTRL + C
```
#### HTOP
<img width="1784" alt="image" src="https://github.com/user-attachments/assets/a08a9d8a-7f7b-4bd8-9206-4a762cff7581" />

```
This tool is a more mouse friendly and customizable.
Very similar to Glances

*** NOTE ***
selection takes place at top of cursor, not center
```
Install:
```
sudo apt install htop
```
Launch tool:
```
htop
```
See help:
```
htop -help
```
Kill tool:
```
CTRL + C
```
### STATUS(ES)
#### MAINNET
**dandelion status**
```
cd [dandolite mainnet directory]
scripts/dandoman.sh
DOCKER
STATUS
```
  <img width="444" alt="image" src="https://github.com/user-attachments/assets/04a20e73-6534-4384-aa32-9566388a5601" />

**ogmios check**
```
docker inspect --format "{{json .State.Health }}" dandolite-preprod-cardano-node-ogmios-1 | jq
```
  <img width="555" alt="image" src="https://github.com/user-attachments/assets/a2ecaf10-483d-49dd-8c57-8886a36eb517" />

**cardano dbsync check**
```
docker inspect --format "{{json .State.Health }}" dandolite-preprod-cardano-db-sync-1 | jq
```
  <img width="548" alt="image" src="https://github.com/user-attachments/assets/c7222cd3-b393-4fb7-88ce-67fe7883d90c" />

**koios tip**
```
curl http://127.0.0.1:8050/koios/v1/tip

*** NOTE ***
you will notice { } - empty brackets before [username]bash, indicating you are on-tip
```
  <img width="556" alt="image" src="https://github.com/user-attachments/assets/7c826943-9de3-4120-ba2f-56cdff4521d4" />

#### PREPROD
**dandelion status**
```
cd [dandolite mainnet directory]
scripts/dandoman.sh
DOCKER
STATUS
```
<img width="449" alt="image" src="https://github.com/user-attachments/assets/bd2f6326-e4d0-43a3-a53d-5f183b2212f5" />

**ogmios check**
```
docker inspect --format "{{json .State.Health }}" dandolite-preprod-cardano-node-ogmios-1 | jq
```
<img width="552" alt="image" src="https://github.com/user-attachments/assets/2d1c34af-ecff-4206-b17f-a3f989486735" />

**cardano dbsync check**
```
docker inspect --format "{{json .State.Health }}" dandolite-preprod-cardano-db-sync-1 | jq
```
<img width="548" alt="image" src="https://github.com/user-attachments/assets/a0f0ecf8-8f91-4560-b822-bd4fa55457bb" />

**koios tip**
```
curl http://127.0.0.1:8050/koios/v1/tip

*** NOTE ***
you will notice { } - empty brackets before [username]bash, indicating you are on-tip
```
<img width="548" alt="image" src="https://github.com/user-attachments/assets/c5cf93e7-7cfa-4942-9f5a-cc4a05301751" />


### DRIVE STABILITY/USAGE
**mainnet**
```
8.0K    /home/piza/.local/share/containers/storage/volumes/dandolite-mainnet_dbless-cardano-token-registry-data
11G    /home/piza/.local/share/containers/storage/volumes/dandolite-mainnet_db-sync-data
201G    /home/piza/.local/share/containers/storage/volumes/dandolite-mainnet_node-db
8.0K    /home/piza/.local/share/containers/storage/volumes/dandolite-mainnet_node-ipc
169G    /home/piza/.local/share/containers/storage/volumes/dandolite-mainnet_postgresdb
8.0K    /home/piza/.local/share/containers/storage/volumes/dandolite-mainnet_unimatrix-data
```
**preprod**
```
8.0K    /home/piza/.local/share/containers/storage/volumes/dandolite-preprod_dbless-cardano-token-registry-data
4.4G    /home/piza/.local/share/containers/storage/volumes/dandolite-preprod_db-sync-data
12G    /home/piza/.local/share/containers/storage/volumes/dandolite-preprod_node-db
8.0K    /home/piza/.local/share/containers/storage/volumes/dandolite-preprod_node-ipc
21G    /home/piza/.local/share/containers/storage/volumes/dandolite-preprod_postgresdb
8.0K    /home/piza/.local/share/containers/storage/volumes/dandolite-preprod_unimatrix-data
```
---
###### 15 APRIL 2025

### CHANGE `WAL VALUE` IN POSTGRES
#### Background
  ```
  While running the following command: docker logs -f dandolite-mainnet-postgress-1 
  A message was frequently displayed:
  
  HINT: Consider increasing the configuration parameter "max_wal_size"

  Leading to inquiring how to change the `max_wal_size`
  ```
#### Navigate into the correct directory
  ```
  Change directory to correct container
  
  cd into container directory
  
  example: cd services/dandelion-lite
  ```
  check `max_wal_size`
  ```
  docker compose exec -it postgress psql -U dandelion_user -d dandelion_lite -c `SHOW max_wal_size`
  ```
  output is likely `1GB`
  
#### Changing the `max_wal_size`:

  - if currently still in Postgres interface (from above)
    paste the following
    ```
    ALTER SYSTEM SET max_wal_size = '2GB';
    SELECT pg_reload_conf();
    
    press ENTER
    ```
    exit
    ```
    \q
    ```
  - if at bash follow these start [HERE](https://github.com/st8tikratio/Uselessness/blob/main/node-operations/13-apr-2025.md#navigate-into-the-correct-directory)
### CHECK POSTGRES VERSION
change directory to correct container
```
cd into container directory

example: cd services/dandelion-lite
```
check **postgres** version
```
docker compose exec -it postgress psql -U dandelion_user -d dandelion_lite
SELECT version();
```
ouput
```
Your output should be similar to:

PostgreSQL 16.1 (Debian 16.1-1.pgdg110+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 10.2.1-6) 10.2.1 20210110, 64-bit
```
exit
```
\q
```

### OBSERVED POWER USAGE
```
Measured from a Cyberpower 1500W Battery Backup
```
| **TYPE**   | **UNIT**    | **MEASUREMENT 1** | **MEASUREMENT 2** |
| ---------         | ---------   | ---------------    |  -------------    |
| **FIXED OBSERVATION**  | | | |
| `input voltage`   | volts (V)   | 122                |     --            |
| `output voltage`   | volts (V)   | 122                |     --           |
| `output frequency` | hertz (Hz)  | 60                 |   --             |
| **RANGED OBSERVATIONS** | | | |
| power usage        | watts (W)    | 210  | 283  |
| power draw         | volts (V)    | 204  | 218  |


### ROGUE PROCESS (postgresdb)
- now sitting at 1.33TB on `home`, then right back to 1.31TB within seconds
- it is `dandolite-mainnet_postgresdb` causing the exceptional disk usage

#### REMOVING EXISTING CONTAINER AND RE-IMPLEMENTING
remove postgresdb container
```
cd [your path to dandelion-lite mainnet]

eample:
cd services/dandelion-lite
```
```
docker compose down
```
```
./scripts/docker/list-volume-sizes.sh
```
```
docker volume rm /dandolite-mainnet_postgresdb
```
```
docker compose up
```
check that container is gone
```
./scripts/docker/list-volume-sizes.sh
```
re-initialize postgres
```
scripts/dandoman.sh
```
```
select Docker
```
```
select Docker Status
```
make sure all things show up
- if not, wait or check back later

```
select BACK
```
```
select SETUP
```
```
select INTIALIZE POSTGRES
```

### Docker Volume Sizes
- checked `docker volume sizes` using
```
./scripts/docker/list-volume-sizes.sh
```
- output
<img width="899" alt="image" src="https://github.com/user-attachments/assets/be9dbcaa-630a-4305-9228-3345ea978627" />

### ~~Docker's False Positive~~
#### **LATER TOLD THE OUTPUT FROM THE BELOW IS NOT ACCURATE**
```
- navigated to both:
  cd services/dandelione-lite
  cd services/dandelion-lite-preprod
and executed
  scripts/dandoman.sh
```

### Glances (Sys Overview)
- `home` dropped to `1.30T` then quickly jumped to `1.31T`
- `glances` output below
<img width="1800" alt="image" src="https://github.com/user-attachments/assets/735486a8-f158-4e71-b1fa-683b7f0b63fc" />

---


###### 13 APRIL 2025
## Pre-shutdown
- Primary drive sitting at `1.33 TB`
- CPU usage `very high`
- Uptime is `< 36 hours`
- There are four instances of:
  ```
  /bin/sh -c echo ...
  
  These are associated with ogmios and port 1337 and vary in CPU usage over time.
  ```
  
  ![galnces-preShutdown-13-apr-2025](https://github.com/user-attachments/assets/051e44fc-2eb3-44f1-888e-1c96b5b7c41d)

## Post-shutdown
- Primary drive now at `1.30 TB`
- Brave usage is `weird and high`, it appears
- Guess is `THE PROCESSES BELOW` are associated with the Desktop version of Ubuntu and not present in Server
- Researching ways to kill or remove the following processes

  ```
  Evolution Services - https://askubuntu.com/questions/1350406/proper-way-to-disable-evolution-services-when-its-purged-already
  Tracker-Miner-F3 - https://unix.stackexchange.com/questions/704220/what-is-tracker-miner-f-and-how-to-stop-it
  Pipewire Pulse and wireplumber
  ```
  ![galnces-postShutdown-13-apr-2025](https://github.com/user-attachments/assets/e2fd133a-5d6c-405b-b8c2-bc95f0b5431b)

##### 11 APR 2025

```
Recognized four instances of `patches` running in Glances
All instances are related to OGMIOS
```

<img width="1765" alt="image" src="https://github.com/user-attachments/assets/0bd24271-c4f7-48f9-b030-13448a217753" />

```
The below image was found in the mainnet DOCKER logs

NOTES:
You will need to zoom-in in order to see the entry
```
<img width="1796" alt="image" src="https://github.com/user-attachments/assets/b4bddb05-84fb-4ed8-9ae3-c94f4a3df99e" />

#### Shortly after the above; the log terminated with the following:
```
Error response from daemon: no container with ID f6ad5f554dc95fe7c5c18d0d28049089bf23078f0a5d56dd87d848163499bb02 found in database: no such container
Error: executing /usr/local/bin/docker-compose-v2 logs -f: exit status 1
```
